{% extends "base.html" %}

{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static 'css/agregar_producto.css' %}">
{% endblock %}

{% block body %}
  <div class="container mt-5">
    <h2>Agregar Producto</h2>
    <form method="post" enctype="multipart/form-data" id="productoForm">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary">Agregar Producto</button>
    </form>
  </div>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script type="text/javascript">
    $(document).ready(function () {
      $('#id_categoria').change(function () {
        var url = "{% url 'load_subcategorias' %}";  // Obtener la URL desde las URL patterns
        var categoriaId = $(this).val();

        $.ajax({
          url: url,
          data: {
            'categoria_id': categoriaId
          },
          success: function (data) {
            $('#id_subcategoria').html('');  // Limpiar el campo de subcategoría
            $.each(data, function (key, value) {
              $('#id_subcategoria').append('<option value="' + value.id_subcategoria + '">' + value.nombre + '</option>');
            });
          }
        });
      });

      // Ajuste automático del textarea de descripción
      $('#id_descripcion').on('input', function () {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });

      // Inicializar el tamaño del textarea de descripción en carga
      $('#id_descripcion').each(function () {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });
    });
  </script>
{% endblock %}